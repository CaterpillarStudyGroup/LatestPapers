
# Physics-based fluid simulation in computer graphics: Survey, research trends, and challenges

**摘要**：基于物理的流体模拟在计算机图形学领域正扮演着日益重要的角色。该领域的最新方法极大地提升了复杂视觉效果的生成能力及其计算效率。新颖的技术不断涌现，用以处理复杂边界、多相流体、气液界面以及精细细节等问题。机器学习、图像处理与流体控制技术的并行应用，带来了众多引人入胜且新颖的研究视角。在本综述中，我们介绍了支撑基于物理的流体模拟的理论概念及其实际实现方法，旨在为刚接触该领域的研究人员以及资深学者探索基于物理的流体模拟（尤其聚焦过去十年的发展）提供一份指南。基于该领域近期发表的文献分布，我们将综述内容结构化，涵盖物理背景、离散化方法、解决可扩展性问题的计算方法、流体与其他材料及界面的相互作用，以及用于表面细节表现与控制的各类方法。从实践角度出发，我们还概述了实现上述方法的现有可用工具或代码库。    

1 北京科技大学北京材料基因工程高精尖创新中心、智能科学与技术学院、顺德创新学院，北京 100083，中国。    
电子邮件：X. Wang, wangxiaokun@ustb.edu.cn; J. Wang, no4724722205@163.com; C. Song, 18519225284@163.com; X. Ban, banxj@ustb.edu.cn ( )。   

2 伯恩茅斯大学媒体与传播学院国家计算机动画中心，普尔 BH12 5BB，英国。    
电子邮件：J. Chang, jchang@bournemouth.ac.uk ( ); J. J. Zhang, jzhang@bournemouth.ac.uk。  

3 格罗宁根大学伯努利研究所，格罗宁根 9700 AK，荷兰。  
电子邮件：Y. Xu, Yanrui.xu@rug.nl; J. Kosinka, j.kosinka@rug.nl。  

4 北京大学计算机学院，北京 100871，中国。  
电子邮件：sinuoliu@pku.edu.cn。  

5 南开大学计算机学院 TMCC，天津 300350，中国。  
电子邮件：rb@nankai.edu.cn。   

6 乌得勒支大学信息与计算科学系，乌得勒支 3584 CC，荷兰。   
电子邮件：a.c.telea@uu.nl。   

7 斯旺西大学建模、数据与人工智能辛基维奇研究所，斯旺西 SA1 8EN，英国。  
电子邮件：c.f.li@swansea.ac.uk。  

8 辽宁省材料研究院材料智能技术研究所，沈阳 110004，中国。  

∗ 王晓坤与徐砚锐对本文贡献相同。   
收稿日期：2023年1月26日；接受日期：2023年7月1日   

关键词 计算机图形学；物理仿真；流体仿真；流体耦合   

1. 引言    
流体作为自然环境中无处不在的存在，是视觉仿真中至关重要的元素。其多变的运动形态与复杂的行为特性，使其成为图形仿真中极具吸引力却又难以描述和计算的对象。正因如此，流体仿真长期以来一直是计算机图形学最重要的研究方向之一。随着计算机技术的发展，直接基于流体动力学控制方程模拟复杂流体现象已成为可能。为此，学界提出了多种基于物理的方法与技术，涵盖从简单但不精确的模型，到逐步优化、能捕捉交互介质中日益复杂动力学的精密技术。这些方法在假设条件、建模能力及底层实现技术等方面差异显著，其多样性使得理解当前前沿进展颇具挑战性，尤其对从业者和新进入者而言更是如此。    

本综述旨在通过梳理计算机图形学中基于物理的流体仿真的主要研究主题及其在过去十年间的新趋势，应对上述理解挑战。文中探讨了流体仿真的不同目标、为实现这些目标提出的技术、相关技术面临的挑战以及该领域的关键研究发现。我们以自上而下的方式组织本综述，结构如下：第2节阐述我们从文献（重点关注过去十年）中收集相关工作的研究方法，并将流体仿真分为七个主要主题。第3节介绍了理解综述后续内容所需的物理背景及流体仿真采用的离散化方法。第4至10节分别对在上述七个主题中发现的文献进行讨论：第4节介绍用于加速第3节所述仿真模型实现的各种高级自适应、并行及数据驱动计算方法。随后三节详述更具体且更具挑战性的仿真场景：流体与不同材料的交互（第5节）、多相仿真（第6节）以及气液界面（第7节）。第8节与第9节分别讨论通过控制模拟流体的外观与运动来提升质量的艺术化手段。第10节探讨特殊流体。最后，第11节通过指出未来研究的关键方向总结全文。附录介绍并讨论了涵盖数值仿真、建模与渲染的流体仿真软件实现。   

2. 综述构建方法     
基于物理的流体仿真是一个活跃了数十年的研究领域，其研究融合了来自工程学、物理学、数学和计算机科学等多个不同学科的贡献。若一篇综述试图全面覆盖所有这些领域的范畴，则篇幅将过于庞大。此外，我们认为计算机图形学领域的研究者与实践者的关注点通常集中于上述方面的某个子集，因此我们据此构建了本次综述的结构如下。   

我们选择以《ACM图形学汇刊》（TOG）、《IEEE可视化与计算机图形学汇刊》（TVCG）及《计算机图形学论坛》（CGF）这三本公认最具影响力与代表性的计算机图形学期刊上发表的论文作为主要信息来源。由于本综述旨在涵盖近期研究趋势，我们纳入了这些期刊在过去十年间（2012年至2022年）发表的所有相关论文。此外，我们还收录了在重要图形学会议（如ACM SIGGRAPH/欧洲图形学计算机动画研讨会[SCA]、ACM SIGGRAPH及ACM SIGGRAPH Asia）上发表的若干论文。最后，我们也纳入了一些对近期研究产生显著影响的早期文献。总计我们收集并深入分析了符合上述标准的327篇论文。   

基于物理的流体仿真在计算机图形学中的起源可追溯至20世纪70年代"粒子系统"的发展[1]。然而，一个成熟且相对稳定的流体动画物理仿真系统直到上世纪末才得以实现[2]。在此后的十年间，各类模拟策略持续演进，重点聚焦于提升流体仿真的稳定性、精确性与效率。我们将在第3.3节讨论此方面的早期进展。随后，针对特定流体现象的研究与仿真效果的定制化工作开始涌现并逐渐兴起。   

随着我们进入2010年代——本综述论文聚焦的核心时期——流体仿真的主要研究方向已转向解决那些利用传统仿真方法难以实现的特定效果。伴随这一转变，机器学习技术的进步为神经网络与仿真算法的融合开辟了新途径，从而拓展了流体仿真领域的可能性边界。鉴于本综述旨在全面探讨该领域的当前进展，我们基于对这些文献的深入分析，将所收集的论文划分为七个相关主题，这些主题贯穿了过去十年的研究脉络。随后，我们在每个主题中选取了具有代表性的论文子集，并将对其进行更为详尽的探讨。   

![](./assets/206-1.png)   

图1展示了本综述结构的第一层级，其中包含了我们归纳出的七个主题。后续层级进一步细分为各子主题。这七个主要主题如下：     

- **先进计算方法**（第4节）：旨在充分利用高性能并行计算资源进行流体仿真的各类方法。    
- **流体与多材料耦合**（第5节）：模拟流体与不同形状、纹理的固体对象之间交互作用的方法。    
- **多相液体**（第6节）：模拟不同相态液体之间交互效应的方法。    
- **气液界面**（第7节）：处理气液界面受力主导流体运动的场景所涉及的方法。   
- **精细细节增强**（第8节）：专注于在细节层面保持/增强流体运动表现的方法。    
- **流体控制**（第9节）：允许视觉设计者控制流体仿真外观与风格的方法。   
- **特殊流体**（第10节）：模拟非常规流体的方法，例如高粘性/稀薄流体、对磁场敏感的流体，或那些严格意义上并非流体但具有类流体行为的材料。   

我们提出的七主题分类法，首要目的在于识别过去十年间的显著趋势。因此，这些主题的划分是基于收集到的文献中有相当一部分可归入各类别；换言之，这些主题反映了过去十年流体研究如何发展的"数据驱动型组织方式"。这与其他综述所采用的方法形成对比——后者通常是作者基于预先定义的理论驱动型分类框架对研究成果进行归类。    

通过分析文献中各主题的分布及其随时间演变的情况，我们可以获得有价值的洞察。图2展示了七个主题各自的论文数量。可以看出，尽管存在差异（某些主题的关注度高于其他），但每个主题都拥有相当数量的文献支撑，平均每年产生4至8篇顶级论文，这印证了我们所划分的主题能有效组织相关研究。图3进一步深化了这一洞察，展示了各主题逐年发表文章的数量分布。我们注意到，虽然部分主题的发表量呈上升趋势（例如先进计算方法，即图3中的红色曲线），但所有七个主题在过去十年间均保持"活跃"状态——这再次表明它们适合作为本综述的组织框架。   

![](./assets/206-2.png)

![](./assets/206-3.png)    

**3 流体仿真概述**     

计算机图形学中的流体仿真发展深深扎根于物理学史。19世纪，艾萨克·牛顿爵士、克洛德-路易·纳维等科学家对流体力学理解作出了重要贡献，为纳维-斯托克斯方程的建立铺平了道路。这些控制流体运动的方程构成了现代流体仿真算法的基础。    

本节将对流体仿真进行基础性介绍，并为后续综述内容提供背景知识。如需更全面理解流体仿真原理，建议参阅Bridson的专著[3]。关于基于拉格朗日观点的光滑粒子流体动力学及物质点法的具体知识，可分别参考Koschier等人[4]与Jiang等人[5]的综述文献。建议对本领域不熟悉的读者在继续阅读前先学习本节内容。我们将首先介绍流体仿真背后的相关物理原理，包括连续介质假设（第3.1节）与纳维-斯托克斯方程（第3.2节），随后概述该领域的早期发展（第3.3节），其中将简要阐述不同离散化策略的核心思想。   

![](./assets/206-表1.png)   

**表1** 总结了本综述中使用的主要符号表示。我们采用这些符号，并结合下标、上标及括号等形式，配合参数来指代这些物理量在不同条件下的对应量值，具体用法将在后文相关语境中说明。

**3.1 流体力学**  
自然界中的物质由原子和分子构成，它们彼此离散并由空间分隔。若在微观层面模拟流体以描述宏观现象，即便使用超级计算机，也往往需要数周甚至数月的计算时间。计算机图形学所追求的，是在效率与保真度之间达到平衡。为此，基于**连续介质假设**的流体力学，便成为了模拟其物理特性的基本层面。  

流体力学将物体建模为物质在其体内**连续分布**的实体，这种近似称为**连续介质假设**。这意味着，流体中任何无限小的体积元都被视为连续介质，也称为**流体微团**。正如朗道和栗弗席兹所述[6]，流体微团“相较于所考虑物体的体积非常小，但相较于分子间距则足够大”。

在流体力学中，**连续性方程**描述了物理量在时空中的输运，如公式(1)所示：  

![](./assets/206-公式1.png)   

其中 **A** 可为任意标量、矢量或张量形式的物理属性，**u** 表示速度，**s** 是 **A** 的源项，所有这些量均定义于时间 **t** 和位置 **x**。公式 (1) 表明，在固定位置处任何物理属性的变化率 **∂A/∂t** 取决于 **Au** 通量所带来的变化以及源项 **s** 的贡献。

**拉格朗日与欧拉视角**：针对公式 (1) 中的物理属性 **A**，流场可从拉格朗日或欧拉视角进行分析，如下所述。

**欧拉视角** 基于固定位置来研究物理场。在给定位置 **x** 处物理量 **A** 的变化率即为公式 (1) 中的 **∂A(x, t)/∂t** 项，该变化来源于通量项与源项的共同作用。虽然直观，但这一视角并未显式表达连续介质假设中流体微团的运动，因为微团始终在不同时刻流经固定的空间位置。

**与之相反，拉格朗日视角** 通过将公式 (1) 改写为以下形式，研究物理属性相对于流体微团的变化率：    

![](./assets/206-公式2.png)   

其中 **D(·)/Dt** 即所谓的**物质导数**，表示流体微团内物理量 **A** 的变化率。在公式（2）中，**u** 与 **s** 分别指特定流体微团的速度与源项。因此，所有位置 **x** 均可替换为微团标识符 **ι**。为简洁起见，在下文中，除非上下文要求，我们将省略对 **(x, t)**、**(t)** 及 **ι** 的显式标注。  

**3.2 纳维-斯托克斯方程**  
从拉格朗日到欧拉视角，研究人员已发展出多种计算流体运动的方法。然而，几乎所有方法的理论基础都源于**纳维-斯托克斯方程**。该方程描述了流体流动的动力学规律，是流体仿真的根本基础。因此，我们接下来对其进行简要阐述。

**质量守恒**：在封闭系统中，流体的质量随时间保持守恒。该原理由连续性方程（公式（1））表示。令 **A** 为流体密度，并设 **s ≡ 0**，则公式（1）可改写为：   

![](./assets/206-公式3.png)   

在不可压缩流动的情况下，流体内的密度变化保持恒定，即 **Dρ/Dt = 0**。该条件进一步意味着速度场**无散度**，其表达式为：  

![](./assets/206-公式4.png)   

**纳维-斯托克斯动量方程**：为进一步描述不可压缩流体流动的运动特性，可对每个流体微团的动量进行分析。将动量项 **ρu** 代入公式（1），并利用公式（3），可得：  

![](./assets/206-公式5.png)   

其中 **sm** 是改变各流体微团速度的**动量源项**，符号 **⊗** 表示**外积运算**。在此基础上，**黏性可压缩流**的纳维-斯托克斯动量方程基本形式进一步将 **sm** 具体表述为三个独立项：   

![](./assets/206-公式6.png)   

其中 **p** 表示**压力**，**g** 为**重力加速度**，**µ** 是描述流体粘性程度的**动态粘性系数**。公式（6）表明，流体微团的速度变化率受三个力项的影响：**压力项（−∇p）**、**粘性项（µ∇2u）** 以及**重力项（ρg）**。

**3.3 模拟策略**  
**3.3.1 早期发展**   

随着计算机技术在20世纪的发展，数值方法在求解包括纳维-斯托克斯方程在内的偏微分方程中逐渐普及。得益于强大的计算机硬件与软件的出现，计算机图形学开始引入这些基于物理的算法，使得流体模拟的逼真度日益提升。

追溯至20世纪70年代，卢卡斯影业计算机部门计算机图形小组的威廉·T·里夫斯率先开创了粒子系统的发展[1, 7]。该系统使得电影中烟雾、火焰等元素的真实感呈现成为可能，这在《星际迷航2：可汗怒吼》中可见一斑。这一突破为计算机图形学早期的流体仿真技术奠定了基础。

20世纪90年代，基于物理的流体仿真开始兴起。韦伊赫特与豪曼[8]采用简化版的纳维-斯托克斯方程模拟无旋、不可压缩的线性化流体流动，为流体动画提供了物理基础。随后，斯坦与菲乌梅[9]引入了完整的纳维-斯托克斯方程以创建湍流风效。

在拉格朗日方法方面，德布伦与加斯克尔[10]将光滑粒子流体动力学引入计算机图形学领域，用于模拟高度可变形的物体。在欧拉方法方面，福斯特与梅塔克萨斯[11]在固定网格上利用纳维-斯托克斯方程模拟流体运动。流体仿真研究在20世纪末随着斯坦的“稳定流体”方法[2]达到一个重要里程碑。该方法最终使得稳定的、三维的、基于物理的流体仿真成为可实现的目标，并能生成逼真的流体效果。这是首个无条件稳定的流体仿真方法，引入了半拉格朗日平流的概念，也是该领域最早应用混合仿真思路的研究之一。   

流体模拟中的**混合方法**融合了拉格朗日与欧拉方法的优势，从而构建出更具通用性和鲁棒性的系统。支撑混合流体模拟的两个基本原理分别是哈洛[12]提出的**质点网格法**，以及布拉克比尔与鲁佩尔[13]改进的**流体隐式粒子法**。这些技术在21世纪极大地推动了混合流体模拟的成功普及与应用。该领域还取得了一项重要进展：朱和布里德森[14]将FLIP方法应用于不可压缩流模拟。这使混合流体模拟达到了新的高度，得以以更高的精度和稳定性探索复杂的流体动力学。混合流体模拟技术的持续演进对计算机图形学产生了深远影响，为创造逼真且视觉震撼的效果提供了支持。

**3.3.2 离散化策略**  
自20世纪早期发展以来，计算机图形学中的流体模拟已逐步演化并分支为三个主要方向：**欧拉法**、**拉格朗日法**以及**混合方案**。每种方法都具有独特的优势与挑战，共同推动了对计算机图形学中流体动力学的全面理解。  

**欧拉方案**：这类仿真方法采用第3.1节介绍的欧拉视角，即在模拟域内的固定点计算物理量值。为此，计算域通常被划分为均匀分布的网格单元。在传统的**同位网格**结构（图4(a)）中，所有物理量值均在每个单元中心计算。要推导出任意位置（如图4(c)中灰点处）具有量值的连续流场，可采用相邻单元值的加权插值。**交错网格**（图4(b)）则将物理量值分别存储在单元边与单元中心。相较于同位网格，交错网格因具有更高的稳定性，目前在不可压缩流体模拟中更为常用。值得注意的是，交错网格与**标记网格法**（Marker-and-Cell, MAC）[15]相关，该方法是计算流体动力学早期用于求解不可压缩流动问题的技术。   

![](./assets/206-4-1.png)    
![](./assets/206-4-2.png)    

**拉格朗日方案**：在拉格朗日框架中，计算域的离散化基于一组随流体移动的粒子，每个粒子近似代表一个流体微团的物理量值。因此，拉格朗日方案**天生具有质量守恒特性**。由于粒子在计算域中的分布位置相比网格覆盖同一区域时自由得多，拉格朗日方案也擅长模拟**复杂的自由表面细节**。     

**SPH方法** 是当前流体仿真中最主流的拉格朗日方法之一，其起源可追溯至Lucy [16] 以及Gingold与Monaghan [17]的研究工作。SPH历经了显著的发展与改进。图5展示了SPH如何进行插值计算：位于粒子i位置 **xi** 处的物理量值 **A** 通过一个光滑核函数 **W** 计算得出，如公式（7）所示：   

![](./assets/206-公式7.png)   

其中 **h** 称为**光滑长度**，**V** 是每个粒子（所代表的微团）的体积，**j** 表示所有与粒子 **i** 的距离小于 **h** 的粒子。为计算更高阶的物理量（例如压力梯度），只需将公式（7）中的核函数 **W** 替换为其对应的高阶形式（在本例中即梯度形式）。   

![](./assets/206-5.png)   

当前，**光滑粒子流体动力学**已成为流体仿真领域最主流的拉格朗日方法之一，其理论基础源自Lucy[16]以及Gingold与Monaghan[17]的开创性研究。SPH方法历经了持续的演进与发展，形成了多个重要分支。图5展示了SPH的插值原理：粒子**i**在位置**xi**处的物理量值**A**通过光滑核函数**W**进行计算，如公式（7）所示：

**初始阶段**，研究者提出了**弱可压缩SPH（WCSPH）**[18]方法，该方法采用显式方式计算压力。随后，**预测-校正不可压缩SPH（PCISPH）**[19]方法被提出，引入了基于预测-校正机制的隐式压力计算方案。该技术通过更有效地强制执行不可压缩条件，显著提升了流体仿真的稳定性与精度。进一步的发展催生了**隐式不可压缩SPH（IISPH）**[20]方法，它在保证更严格不可压缩性的同时提高了计算效率。**最新进展**中，**无散度SPH（DFSPH）**[21]方法得以发展，该方法在仿真中进一步强化了无散度条件。

**位置动力学**是一种通用且高效的仿真方法，适用于处理包括流体、可变形固体及布料在内的多种物理现象。PBD最初由Müller等人[22]提出，作为传统基于力的动力学的替代方案，其核心思想在于直接操控物体位置，而非计算力与加速度。在流体仿真领域，Macklin与Müller[23]基于PBD原理提出了**位置流体（PBF）**方法，通过迭代调整粒子位置来强制满足不可压缩性。  

**混合方案**：这类方案融合了拉格朗日与欧拉方法的优点，采用拉格朗日粒子表征流体运动，同时在欧拉网格上计算动力学（力）。

如图6所示，为结合粒子与网格，在动力学模拟前后需分别将物理量从粒子映射到网格（P2G）以及从网格映射到粒子（G2P）。这一映射过程通过一种**形函数**完成，其作用类似于SPH方法中的核函数**W**。

**混合方案**可细分为三类：1）**纯粒子网格法**；2）**混合粒子网格法**（常称作FLIP方法）；3）**物质点法**。其中，**纯粒子网格法**完全依赖网格存储的物理量更新粒子状态；**FLIP方法**则混合使用网格与粒子存储的物理量进行更新；**物质点法**进一步扩展了FLIP方法，能够模拟多种材料及其相互作用。

当前，混合方案已发展出多种变体，但大多建立在粒子网格法或物质点法的基础框架之上。**粒子网格法**由哈洛[12]率先提出，后经布拉克比尔与鲁佩尔[13]改进为**流体隐式粒子法（FLIP）**。该方法在粒子与背景网格间传递物理量：首先将粒子物理属性（如质量、动量）映射至网格（P2G）；随后在网格上求解控制方程（如纳维-斯托克斯方程）；最终将更新后的网格物理量插值回粒子位置（G2P）。

**物质点法**最初由萨尔塞多等人[24]提出，是FLIP方法向多材料模拟的扩展。与FLIP相比，物质点法的关键改进在于：除粒子与网格间的物理量传递外，粒子还携带并更新其**变形梯度**。这一扩展使物质点法能够模拟具有复杂本构关系的材料（如弹性体、塑性体）及其相互作用，从而成为处理多材料耦合问题的强大工具。

![](./assets/206-6.png)   

总体而言，混合方案**兼具粒子方法与网格方法的优势**：粒子能自然追踪材料界面与自由表面，而网格背景便于高效求解偏微分方程。这使得混合方案特别适用于涉及**复杂界面、大变形及多材料相互作用**的物理仿真场景。   

在**原始的PIC方法**[24]中，仅动量项在粒子和网格之间传递。后来提出的**FLIP方法**[13]转而传递动量的差分，以牺牲一定稳定性为代价，获得了更好的动态效果。Sulsky等人[25]提出的**物质点法**是原始PIC的另一个重要扩展。它通过引入**变形梯度信息**，并考虑动量项，为流体模拟增添了新的维度，使其适用于模拟包括流体、颗粒材料和可变形固体在内的广泛材料。

在PIC、FLIP和MPM方法的发展过程中，这些技术不断演进与融合，形成了更先进的方法。**仿射粒子网格法**通过结合仿射速度场扩展了MPM框架，相比PIC和FLIP，减少了数值耗散并提高了稳定性。**多项式粒子网格法**在APIC的进展基础上更进一步，引入了更高阶的多项式速度场。最后，**移动最小二乘物质点法**在MPM模拟中利用移动最小二乘法进行网格插值和微分，进一步增强了该方法的精确性与鲁棒性。   

**4 先进计算方法**  
流体仿真需要高离散化分辨率以达到高视觉质量。然而，离散粒子数量的增加或网格密度的提升都意味着更高的计算资源需求。本节将综述近年来提升计算效率的方法，并将其归类为采用**自适应时间和/或空间采样**（第4.1节）、**GPU或CPU并行化**（第4.2节）以及较新的**数据驱动方法**（第4.3节）的研究。关于该领域更全面的综述，可参考Manteaux等人的工作[29]。

**4.1 自适应解决方案**  
一个稳定、足够精确且细节丰富的仿真需要充分的时间和空间分辨率。时间步长必须足够短以确保稳定性，而高分辨率网格或密集的粒子则用于捕捉精细细节。然而，计算成本随着时空分辨率的提升而增加，并且并非所有区域始终需要全局高分辨率。例如，剧烈运动时需要较小的时间步长，而当整体运动平缓时则可采用更长的步长；捕捉精细的飞溅和喷射效果需要高空间分辨率，但在流体内部深处，此类细节不可见，高分辨率的重要性则降低。

因此，**自适应方法** 仅在必要的时间和空间位置采用高分辨率，而在其他区域使用低分辨率以降低计算成本。图7以粒子为例展示了这一策略。自适应方法可分为**时间自适应**和**空间自适应**。时间自适应（全局或局部）动态调整流体不同部分的时间步长。空间自适应则根据不同流体区域调整分辨率，或改变离散化方法以达到类似效果。下文将分别阐述这两种方法。   

**4.1.1 时间自适应**

![](./assets/206-7.png)   

时间自适应方法动态调整时间步长。一种直接策略是进行**全局自适应**，即为整个模拟域使用统一的时间步长。其步长大小需在一定的约束条件下，于每个时间步动态确定。为了进一步提升性能，可为模拟域中不同的空间区域采用不同的时间步长，从而减少所需的**积分步骤**总数；这种**局部自适应**方法尤为重要，因为它是提升整体性能的关键所在。    

**全局时间步长**。**库朗-弗里德里希斯-列维条件**是确定时间步长的一种常用方法。当前大多数仿真方法都根据CFL条件在每个时间步计算一个全局时间步长。通常，CFL条件的形式如下：

![](./assets/206-公式8.png)   

其中 \\(‖u_c‖\\) 表示**信息传播速度**，\\(∆x\\) 在欧拉或混合仿真中代表**网格单元尺寸**，在拉格朗日方法中则指**光滑长度**。\\(C_{\mathrm{max} }\\) 是一个基于离散算子大小的常数，\\(C\\) 即为**CFL数**或**库朗数**。在实际应用中，\\(‖u_c‖\\) 通常指材料中的**声速**或仿真中的**最大流速**。

时间步长 \\(∆t\\) 的选择通常使得 \\(C\\) 处于 **[0, 1]** 范围内。最大库朗数\\(C_{\mathrm{max} }\\)的选取一般取决于所用仿真算法的类型，但其值不应超过 1。相较于SPH方法，PIC或MPM等方法在选择 \\(C_{\mathrm{max} }\\)时通常具有更大的灵活性。在使用**隐式时间积分方案**时，可以在保持仿真稳定的前提下，采用更大的 \\(C_{\mathrm{max} }\\)值。

确定 \\(C_{\mathrm{max} }\\) 的最优值通常需要针对具体场景进行大量试错。Sun等人[32]通过考虑与MPM仿真稳定性相关的度量指标（例如**变形梯度**）来解决这一问题。利用这些指标，他们能够更有效地识别性能极限并提升仿真整体稳定性。

**异步时间积分**。当仿真场景中同时包含剧烈波动与平静区域时，采用全局时间步长限制可能效率低下且造成资源浪费。为解决此问题，Goswami与Batty[33]首先将**区域时间步进**概念引入SPH方法。该方法将模拟空间细分为多个较小区域，允许每个区域拥有独立的的时间步长。Fang等人[34]认识到细分区域的网格特性，将这一思路扩展至MPM方法。在他们的技术中，一个**调度器**确定区块的更新顺序，同时使用一个**缓冲区块**来处理不同时间步长区块之间的边界。这带来了显著的性能提升，相比传统的同步MPM实现，实现了9.8倍的加速。

受Fang等人[34]的启发，Koike等人[30]为欧拉流体模拟提出了一种**异步时间积分器**，其配备了一种处理不同时间步长区域边界的**插值策略**，以及一种防止边界处出现缝隙的**平流方案**。尽管上述方法有效实现了……   

![](./assets/206-8.png)   

上述方法虽已实现不同区域的异步时间步进，但在仿真时间屏障处仍需要对所有区域进行同步。Reinhardt等人[35]为SPH流体动画提出了一种**完全异步时间积分模型**，其中每个粒子拥有独立的时间步长，并通过优先队列进行处理。

**4.1.2 空间自适应**

这类方法通过在不同空间区域改变空间分辨率或离散化方式，以在部分区域保留精细细节，同时在次要区域使用更粗略（计算更快）的细节。空间自适应方法在很大程度上依赖于底层离散化方案。接下来，我们将分别详述针对欧拉法、拉格朗日法和混合法的不同空间自适应方法。

**欧拉网格**。基于网格的欧拉方法使用**自适应网格结构**来实现动态空间分辨率。然而，与均匀分布的欧拉网格相比，在自适应网格上为压力求解设计一个既能达到高阶精度，又能构成对称正定线性系统的模板（stencil）颇具挑战性，尤其是在非对称自适应网格上实现高效求解。

**八叉树数据结构**是一种网格自适应方法，它允许改变轴对齐结构网格的分辨率。如图9所示，每个单元沿每个轴一分为二，可被分割成八个相等的子单元。八叉树具有**规则性**的优势，支持快速离散化和简单实现。然而，在不同网格层级之间的过渡区域，八叉树存在**T型连接点**，这会引发棘手的数值问题。

![](./assets/206-9.png)   

Losasso等人[36]首次提出了一种基于八叉树的液体求解器，它使用一组对称微分算子，使得泊松方程能在不受限的八叉树网格上求解。在该八叉树中，速度存储在单元面上，而压力存储在单元中心。**单元中心处的速度散度** \\(∇ · u\\) 通过考虑所有单元面 \\(f\\) 计算得出，具体为：

![](./assets/206-公式9.png)   

其中 \\(V_c\\) 表示单元体积，\\(n_f\\)、\\(u_f\\) 和 \\(S_f|\) 分别为面 \\(f\\) 的外向法向量、速度和面积。而**每个面上的压力梯度**则通过两相邻单元的压力值计算得出，公式如下：  

![](./assets/206-公式10.png)   

其中 \\(∆x\\) 表示单元尺寸，下标 **1** 和 **2** 指代该面相邻的两个单元。

**动态调整的八叉树网格**在数据修改和访问方面也带来了挑战。Setaluri等人[37]提出了一种**稀疏分页网格**数据结构，它将八叉树构建为一组稀疏填充的规则网格层次结构，而非标准的基于指针的树。Goldade等人[38]认识到八叉树速度场仅具有一阶精度的局限性，并将**变分有限差分离散化方法**应用于此，实现了更高效的黏性模拟。Ando与Batty[39]则专注于使用八叉树网格**专门增强表面细节**。这一方法在保留八叉树优势的同时，进一步降低了实现复杂度。尽管特别关注维持数据顺序以实现高效计算是有利的，但它也给系统设计带来了挑战。Shao等人[40]注意到这个问题，并发现了**规则笛卡尔网格结构**中未充分利用的潜力。他们巧妙地将**单指令多数据**方法与多重网格结构相结合，旨在简化并最小化所需的乘法运算次数。与大型模拟商业软件中现有的自适应八叉树求解器相比，他们的方法实现了**(2.0–14.6)倍**的显著加速。  

另有若干方法受到八叉树网格概念的启发并进行了扩展。这些工作旨在以不同方式提升效率与精度。Ferstl等人[41]提出了一种基于自适应八叉树网格的**六面体有限元离散化多重网格求解器**。通过对自由表面上的边界条件进行特殊处理，他们在表面上实现了**二阶精度**。此外，Aanjaneya等人[42]专注于**增强八叉树上的压力投影**。他们采用**有限体积功率图**来精确恢复跨越网格的不规则嵌入边界，同时满足了**二阶精度**与**对称正定条件**。进一步地，Xiao等人[43]引入了一种**自适应交错倾斜网格**，用于在规则离散化上进行自适应流体模拟。通过在八叉树结构上叠加倾斜网格，他们避免了**T型连接点**，并进一步提升了模拟的自适应性。   

部分流体模拟方法采用具有不同分辨率或结构的**多重网格**来模拟流体的各个部分，随后将这些元素组合在一起。该方法与为整个流体域使用单一自适应网格的方式形成对比。Gao等人[44]设计了一种技术，将求解域划分为**不同分辨率的嵌套分区**，有效处理了多分辨率流体行为。English等人[45]使用**不同尺度和旋转角度的重叠笛卡尔网格**来表示流体域，并通过构建局部**沃罗诺伊图**来管理网格界面附近的压力投影。Li等人[46]则引入了一种**适用于动力学方法的自适应松弛方法**，实现了在任意重叠分辨率下进行流体采样，并能在广泛的尺度范围内高效表征流体行为。

尽管许多使用单一或多个网格结构的自适应方法可能破坏原始笛卡尔网格的统一数据结构，但部分研究在**保持统一性与引入自适应性之间找到了平衡**。Zhu等人[47]在立方体感兴趣区域内使用均匀网格，并通过沿轴向拉伸网格单元将其延伸至远场。这种方法保留了均匀网格的优势，同时在特定区域提供了自适应性。Ibayashi等人[48]提出了一种**动态变形均匀网格**的技术，结合了非结构化网格与结构化网格的优点。

**拉格朗日方法**。基于粒子的拉格朗日方法（如SPH）通过为每个粒子定义所需分辨率（通过尺寸函数），实现空间自适应性。通过局部合并或分裂粒子来调整粒子采样（如图7所示），这些方法能够动态改变分辨率，从而在重点关注感兴趣区域的同时，提供更高效、更精确的仿真。

自适应SPH的早期研究可追溯至Adams等人[49]的工作。他们引入了基于**几何局部特征尺寸**的尺寸函数，使计算资源能够集中于几何复杂的区域。然而，由于分辨率尺度不同，自适应粒子会导致密度误差，可能引发不稳定。为解决此问题，Orthmann与Kolb[50]提出了一种**时间混合技术**，通过限制时间分辨率的变化速率，从而显著减少了误差。随着更严格的隐式SPH方法的出现，相邻粒子的尺寸差异必须最小化以避免不稳定。Winchenbach等人[51]通过调整分裂与合并模式，并在粒子之间引入**质量重新分配**，形成了粒子分辨率的连续过渡，实现了这一目标。他们的方法还纳入了简化版的时间混合。其中，分裂支持任意的**1:\\(n\\)模式**；合并使用\\((n+1):n\\) 模式，即一个粒子被合并到其他粒子中。质量重新分配将粒子i的过量质量 \\(m_{ex}\\) 平均分配给n个粒子，接受质量的粒子j的物理属性A更新为 \\(A^∗_j\\)，其公式为：   

![](./assets/206-公式11.png)   

Zhai等人[52]受此方法启发，提出了一种针对**能量粒子法**的自适应方案。Winchenbach等人[53]则提出了一种**半解析边界处理方法**，以解决基于粒子的边界表示难以与尺寸差异极大的流体粒子相耦合的问题。最近，Winchenbach与Kolb[54]引入了针对分裂模式的**优化细化方法**，该方法使用一个对误差进行建模的**离散化目标函数**，从而显著提升了稳定性。

自适应粒子的**邻居搜索**也需要专门优化。在自适应模拟中，一个粒子在给定距离 \\(h\\) 内的邻居数量可能差异巨大，计算成本高昂。为解决此问题，Winchenbach等人[55]提出了**约束邻居列表**，用于确定用户指定范围内的邻居。为进一步加速邻居搜索过程，Winchenbach与Kolb[56]引入了一种基于**哈希映射**的稀疏数据结构，用于高效的自适应SPH邻居搜索和光线追踪。   

**涡方法**中，基于自适应数据结构高效求解泊松问题的方法也得到研究。泊松问题是一个N体问题，需考虑每个物体与其余物体间的相互作用。直接求解该问题需要 \\(O(N^2)\\) 计算量，因此采用自适应方法来降低复杂度。**快速多极子法**[57]利用八叉树近似求解N体问题，计算复杂度为\\(O(Nlog^ηN)\\)，其中\\(η∈{0,1}\\)。该方法通过以物体中心近似远处物体间的相互作用，避免了所有成对相互作用的计算。Zhang与Bridson[58]提出了一种新颖的**粒子-粒子粒子-网格法**，该方法更易于在GPU上实现和并行化，并将其应用于涡段求解器。Angelidis[59]则采用FMM并增加了对非均匀粒子采样的支持，以模拟带涡流的不可压缩烟雾。

**混合方法**。混合方法因其在流体模拟中本质上融合了拉格朗日与欧拉表示，为实现自适应方案提供了更大的灵活性。Ando等人[63]将**粒子分裂-合并方案**（类似于传统的拉格朗日自适应机制）应用于FLIP方法，根据到流体表面的距离调整流体表示的粒度，并使用最精细的粒子来表现飞溅和水膜。随后，Ando等人[64]提出了一种基于**四面体网格的自适应液体求解器**，它将一种有限元法变体与FLIP平流相结合，能够连贯地自适应调整粒子与四面体网格的尺寸，从而实现更高效的模拟。针对高度稳定的情况，Yue等人[65]探索了在求解器层面将内部区域模拟为**软连续介质材料**以降低计算成本的可能性。

在MPM方法中，自适应性主要体现在**粒子分辨率**上，而其网格通常保持**均匀且规则**。然而，粒子自适应也带来了计算精度的重大挑战，特别是在**变形梯度**的更新与传递方面。为解决此问题，Gao等人[60]提出通过应变能量密度控制粒子合并操作，实现了基于粒子的MPS自适应。Hu等人[61]引入了一种MPM方法，通过采用弹性力学中的**凝聚物质点法**，实现了无损的粒子分裂。最近，Wang等人[62]提出了一种**多分辨率MPM**，通过引入粒子级子结构的概念，能够将子网格尺度的细节凝聚至未变形配置中，从而高效模拟材料点之间的精细尺度相互作用。

为进一步节省计算成本，近期的混合方法致力于通过**仅对模拟流体的内部区域采用欧拉模拟**，而**仅在表面附近应用粒子**的方式来"掏空"流体内部。Chentanez等人[66]提出了**耦合纯拉格朗日与欧拉方法**来模拟单一流体体，解决了两种不同流体求解器之间流体表示转换和**耦合稳定性**的问题。然而，耦合两种不同的求解器仍可能存在不稳定风险，因此Ferstl等人[67]后续回归到自适应FLIP模拟，采用了**仅分布于流体表面窄带内的FLIP粒子**进行仿真。Nakanishi等人[68]则侧重于为FLIP方法构建一种合适的数据结构，以实现八叉树网格的自适应合并与分裂，**仅调整流体表面附近背景网格的尺寸**（图10）。

佐藤等人[68]将自适应性推向极致，他们扩展了Ferstl等人的工作[67]，通过引入的**过渡函数**，利用**水平集表面**替代了部分流体表面。这一思路代表了该领域的突破，使得物理仿真细节与大规模表示能够**无缝融合**。针对表面表示转换过程中存在**低效、高耗散波传播**的问题，黄等人[69]采用了**体积平流-投影离散化**与**基于表面的平流-投影离散化**的混合方法，并对持久波应用了**边界元法**进行求解。  

### 4.2 并行化
仿真算法的并行化为提升流体模拟速度提供了一条前景广阔的途径，其核心在于充分利用现代GPU与CPU固有的并行计算能力。我们将此类方法归纳为三个类别：基于单一处理单元（多核CPU或单个GPU）的并行化；采用多个处理单元（尤其是多GPU）的并行技术；以及基于分布式系统的并行方案（另见图13）。

### 4.2.1 单一处理单元
在单一处理单元（如多核CPU或GPU）上实现并行化最为直接。纯粹的欧拉法和拉格朗日法模拟技术在此类条件下易于并行化。然而，混合方法因其结合粒子与网格的复合特性，需要采取细致的措施。Museth [70] 首创的体素数据块（VDB）方法为操作稀疏体数据提供了一个鲁棒的框架。Wu等人[61]通过解决混合方法中固有的并行粒子到网格光栅化问题，成功将此方法集成到FLIP方法中（图11）。Gao等人[71]基于SPGrid结构[37]在MPM中实现了类似的集成，其中粒子到网格的传输机制是需要解决的关键环节。此外，Chu等人[72]将Schur补理论应用于FLIP模拟并进行了优化。他们将模拟域划分为多个包含面边和交叉点的子域，以建立便于并行的数据结构。为了简化并行程序的开发，Hu等人[73]提出了一种新的面向数据编程语言——Taichi。该语言便于高效地编写、访问和维护稀疏数据结构，并配备了一个专为在CPU或GPU平台上自动优化和并行化代码而设计的编译器。随后，Hu等人[74]对Taichi进行了增强，使其能对数值数据类型进行位级内存控制。   

![](./assets/206-10.png)   

### 4.2.2 多处理单元

![](./assets/206-11.png)   

多GPU技术是扩大模拟规模的首选方案。在此架构下，多个GPU与CPU协同工作，共同构成异构计算结构。该结构最具挑战性的方面在于减少CPU-GPU及GPU-GPU之间数据交换的频率与体量，因为这类数据交换的成本极高。Liu等人[75]率先将舒尔补方法引入图形学领域，作为应对这一问题的策略。如前所述，舒尔补方法的显著优势在于将整个模拟域划分为多个区域。每个区域可由单个GPU高效计算，区域间的交互边界则由CPU优雅地协调管理。这种配置消除了数据从GPU到CPU再传输至另一GPU的需求。与此同时，Wang等人[76]采取了不同的技术路径，直接调整MPM算法结构以适应多GPU框架。他们通过设计粒子数据结构以促进合并内存访问，并在粒子到网格的数据写入过程中规避原子操作，成功实现了这一目标。此外，他们提出了内核融合策略以减少GPU内核启动次数并降低全局内存需求。Chen等人[62]进一步优化了包含复杂固体场景的动力学方法（图12）。他们引入了多内核启动方法以增强并行性，并建立了参数化成本模型以提升性能优化效果。这些对流体模拟并行化技术的探索，充分展现了该领域策略的多样性与灵活性。

### 4.2.3 分布式系统

![](./assets/206-12.png)   

为了追求流体模拟的可扩展性，分布式平台的潜力被用来将任务分配至多个计算节点。这类分布式模拟通常采用自动任务分配机制以确保高效处理。Biddiscombe等人[77]提供了一个基于图形用户界面的高性能计算交互与分析系统，奠定了关键基础。他们的创新方法在于将层次数据格式第五版中的I/O层替换为并行数据传输驱动程序，从而使得并行模拟、分析和图形界面操作能够在一台或多台设备上同步进行。Mashayekhi等人[78]开发了一套系统，能够自动将任务分配到众多多核云计算节点上，以实现对流体分区的动态管理。Shah等人[79]则提出了一种适用于稀疏流体模拟的负载均衡方案。Qu等人[80]概述了一种简单而有效的解决方案来加速分布式流体模拟，该方案利用微分区技术极大改善了负载均衡与通信性能。

![](./assets/206-13.png)   

### 4.3 数据驱动方法

尽管近年来在时空自适应与并行计算方面已取得重大进展，但采用传统物理方法进行流体模拟仍需要高昂的计算资源。在离散化空间中求解控制方程时，为确保模拟稳定性，必须严格限制时间步长。同时，构建高效且精确的端到端流体模拟流程在技术上仍面临巨大挑战。数据驱动方法为实时交互式流体模拟提供了替代解决方案，相关内容将在下文展开概述。   

**4.3.1 模型降阶**

模型降阶通过预计算一组仿真序列以获得流体运动的低维表示，从而实现高效快速的重新模拟。Treuille等人[81]首次通过**Galerkin投影**将模型降阶引入流体模拟。他们基于**主成分分析**构建了流体动力学的矢量场基函数，用以生成实时流体。为此，他们将以下微分方程 **F** 进行**Galerkin投影**至一个**降维空间**：    

![](./assets/206-公式12.png)   

高维空间向量 \\(v ∈ R^n\\) 与低维空间向量 \\(r ∈ R^m\\) 通过投影算子 \\(P(v) = r\\) 及其逆算子 \\(P^{-1}(r) = v\\) 进行转换。  

随后，该领域涌现出多项改进，例如将**Galerkin投影扩展至非多项式系统**[82]，以及支持**半拉格朗日平流**的**多维容积法**[83]。De Witt等人[84]采用**拉普拉斯特征函数**替代PCA特征向量。该方法对纳维-斯托克斯方程的**涡量形式**进行Galerkin投影，因此并非数据驱动，而是**物理驱动**。Liu等人[85]进一步通过**变分积分器**稳定了该方法，提供了无伪影的结构系数。Zhai等人[86]提出了一种基于**经验模态分解**的模型降阶方法，能够将流场分解为不同频率分量作为降阶基向量，该方法可提取原始流体的特征参数以实现**逆向建模**。为降低存储基函数的内存需求，Cui等人[87]利用**解析特征函数**与**快速傅里叶变换**将动力学推广至诺伊曼边界条件，使得使用数千个基函数生成更逼真、更精细的流体动力学成为可能。基于此，他们提出了拉普拉斯特征函数方法的解析扩展[88]，这种**螺旋-谱流体模拟方法**能够在多种径向域（表面与体区域）生成逼真的湍流效果。Mercier与Nowrouzezahrai[89]构建了可适应**弯曲边界**并与动态障碍物耦合的**各向异性矢量场基函数**，该方法以牺牲物理精度为代价实现视觉合理的模拟。Panuelos等人[90]提出了一种基于**不可压缩多项式矢量场**的流体降阶模型，以降低高粘性流体的计算成本。  






![](./assets/206-6.png)   
![](./assets/206-公式7.png)   